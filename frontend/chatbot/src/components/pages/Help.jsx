import React, { useState, useEffect, useRef } from 'react';
import { Mic, MicOff, SendHorizonal, User, Bot, Heart, AlertCircle } from 'lucide-react';
import './hindi.css';

const lawData = {
  categories: {
    "рдШрд░реЗрд▓реВ рд╣рд┐рдВрд╕рд╛": {
      keywords: ["рдкрддрд┐ рдорд╛рд░рддрд╛ рд╣реИ", "рд╕рд╕реБрд░рд╛рд▓ рд╡рд╛рд▓реЗ рд╕рддрд╛рддреЗ рд╣реИрдВ", "рдорд╛рд░рдкреАрдЯ", "рдЧрд╛рд▓реА-рдЧрд▓реМрдЬ", "рдШрд░ рдореЗрдВ рд╣рд┐рдВрд╕рд╛"],
      helpline: "рдорд╣рд┐рд▓рд╛ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: 181 | рдкреБрд▓рд┐рд╕: 100 | рджрд╣реЗрдЬ рд╡рд┐рд░реЛрдзреА рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: 011-26942369"
    },
    "рдХрд╛рд░реНрдпрд╕реНрдерд▓ рдЙрддреНрдкреАрдбрд╝рди": {
      keywords: ["рдСрдлрд┐рд╕ рдореЗрдВ рдкрд░реЗрд╢рд╛рдиреА", "рдмреЙрд╕ рдЫреЗрдбрд╝рддрд╛ рд╣реИ", "рдпреМрди рдЙрддреНрдкреАрдбрд╝рди", "рдХрд╛рдо рдХреА рдЬрдЧрд╣ рдкрд░ рдЕрд╢реНрд▓реАрд▓ рдЯрд┐рдкреНрдкрдгреА"],
      helpline: "рдХрд╛рд░реНрдпрд╕реНрдерд▓ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: 1800-123-123 | NCW рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: 7827-170-170"
    },
    "рдмрд╛рд▓ рд╡рд┐рд╡рд╛рд╣": {
      keywords: ["рдЬрдмрд░рди рд╢рд╛рджреА", "рдХрдо рдЙрдореНрд░ рдореЗрдВ рд╢рд╛рджреА", "рдмреЗрдЯреА рдХреА рд╢рд╛рджреА рд░реЛрдХреЗрдВ", "рдирд╛рдмрд╛рд▓рд┐рдЧ рд╡рд┐рд╡рд╛рд╣"],
      helpline: "рдмрд╛рд▓ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: 1098 | CHILDLINE: 1098"
    },
    "рджрд╣реЗрдЬ": {
      keywords: ["рджрд╣реЗрдЬ рдорд╛рдВрдЧ", "рджрд╣реЗрдЬ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд╛рдбрд╝рдирд╛", "рд╕рд╕реБрд░рд╛рд▓ рд╡рд╛рд▓реЗ рджрд╣реЗрдЬ рдорд╛рдВрдЧрддреЗ рд╣реИрдВ"],
      helpline: "рджрд╣реЗрдЬ рд╡рд┐рд░реЛрдзреА рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: 011-26942369 | рдкреБрд▓рд┐рд╕: 100"
    }
  },
  acts: [
    {
      "рдХрд╛рдиреВрди": "рдШрд░реЗрд▓реВ рд╣рд┐рдВрд╕рд╛ рдЕрдзрд┐рдирд┐рдпрдо",
      "рд╕рд╛рд▓": "2005",
      "рд╡рд┐рд╡рд░рдг": "рдпрд╣ рдХрд╛рдиреВрди рдкрддреНрдиреА рдпрд╛ рдорд╣рд┐рд▓рд╛ рд╕рд╛рдереА рдХреЛ рд╢рд╛рд░реАрд░рд┐рдХ, рдорд╛рдирд╕рд┐рдХ, рднрд╛рд╡рдирд╛рддреНрдордХ рдФрд░ рдЖрд░реНрдерд┐рдХ рд╣рд┐рдВрд╕рд╛ рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЖрдк рддреБрд░рдВрдд рд╕реБрд░рдХреНрд╖рд╛ рдЖрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреА рд╣реИрдВред",
      "рд╕рдорд╛рдзрд╛рди": "рдирдЬрджреАрдХреА рдорд╣рд┐рд▓рд╛ рдерд╛рдиреЗ рдореЗрдВ рд╢рд┐рдХрд╛рдпрдд рджрд░реНрдЬ рдХрд░рд╛рдПрдВ рдпрд╛ 181 рдкрд░ рдХреЙрд▓ рдХрд░реЗрдВ",
      "Category": "рдШрд░реЗрд▓реВ рд╣рд┐рдВрд╕рд╛"
    },
    {
      "рдХрд╛рдиреВрди": "рдХрд╛рд░реНрдпрд╕реНрдерд▓ рдкрд░ рдорд╣рд┐рд▓рд╛рдУрдВ рдХрд╛ рдпреМрди рдЙрддреНрдкреАрдбрд╝рди (рд░реЛрдХрдерд╛рдо, рдирд┐рд╖реЗрдз рдПрд╡рдВ рдирд┐рд╡рд╛рд░рдг) рдЕрдзрд┐рдирд┐рдпрдо",
      "рд╕рд╛рд▓": "2013",
      "рд╡рд┐рд╡рд░рдг": "рдЗрд╕ рдХрд╛рдиреВрди рдХреЗ рддрд╣рдд рдХрд╛рд░реНрдпрд╕реНрдерд▓ рдкрд░ рдорд╣рд┐рд▓рд╛рдУрдВ рдХреЗ рдпреМрди рдЙрддреНрдкреАрдбрд╝рди рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдЦреНрдд рдкреНрд░рд╛рд╡рдзрд╛рди рд╣реИрдВред рд╣рд░ рд╕рдВрд╕реНрдерд╛рди рдореЗрдВ рдЖрдВрддрд░рд┐рдХ рд╢рд┐рдХрд╛рдпрдд рд╕рдорд┐рддрд┐ (ICC) рдмрдирд╛рдирд╛ рдЕрдирд┐рд╡рд╛рд░реНрдп рд╣реИред",
      "рд╕рдорд╛рдзрд╛рди": "рдХрдВрдкрдиреА рдХреА ICC рдХреЛ рд▓рд┐рдЦрд┐рдд рд╢рд┐рдХрд╛рдпрдд рджреЗрдВ рдпрд╛ 1800-123-123 рдкрд░ рдХреЙрд▓ рдХрд░реЗрдВ",
      "Category": "рдХрд╛рд░реНрдпрд╕реНрдерд▓ рдЙрддреНрдкреАрдбрд╝рди"
    },
    {
      "рдХрд╛рдиреВрди": "рдмрд╛рд▓ рд╡рд┐рд╡рд╛рд╣ рдирд┐рд╖реЗрдз рдЕрдзрд┐рдирд┐рдпрдо",
      "рд╕рд╛рд▓": "2006",
      "рд╡рд┐рд╡рд░рдг": "рдЗрд╕ рдХрд╛рдиреВрди рдХреЗ рддрд╣рдд 18 рд╡рд░реНрд╖ рд╕реЗ рдХрдо рдЖрдпреБ рдХреА рд▓рдбрд╝рдХреА рдФрд░ 21 рд╡рд░реНрд╖ рд╕реЗ рдХрдо рдЖрдпреБ рдХреЗ рд▓рдбрд╝рдХреЗ рдХрд╛ рд╡рд┐рд╡рд╛рд╣ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╣реИред рдЙрд▓реНрд▓рдВрдШрди рдХрд░рдиреЗ рдкрд░ 2 рд╕рд╛рд▓ рдХреА рдЬреЗрд▓ рдФрд░ 1 рд▓рд╛рдЦ рд░реБрдкрдпреЗ рдЬреБрд░реНрдорд╛рдирд╛ рдХрд╛ рдкреНрд░рд╛рд╡рдзрд╛рди рд╣реИред",
      "рд╕рдорд╛рдзрд╛рди": "рдЪрд╛рдЗрд▓реНрдбрд▓рд╛рдЗрди 1098 рдкрд░ рддреБрд░рдВрдд рд╕реВрдЪрд┐рдд рдХрд░реЗрдВ рдпрд╛ рдкреБрд▓рд┐рд╕ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ",
      "Category": "рдмрд╛рд▓ рд╡рд┐рд╡рд╛рд╣"
    },
    {
      "рдХрд╛рдиреВрди": "рджрд╣реЗрдЬ рдирд┐рд╖реЗрдз рдЕрдзрд┐рдирд┐рдпрдо",
      "рд╕рд╛рд▓": "1961",
      "рд╡рд┐рд╡рд░рдг": "рджрд╣реЗрдЬ рд▓реЗрдирд╛ рдФрд░ рджреЗрдирд╛ рджреЛрдиреЛрдВ рд╣реА рдЕрдкрд░рд╛рдз рд╣реИред рджрд╣реЗрдЬ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд╛рдбрд╝рд┐рдд рдХрд░рдиреЗ рдкрд░ 5 рд╕рд╛рд▓ рддрдХ рдХреА рдЬреЗрд▓ рдФрд░ рдЬреБрд░реНрдорд╛рдирд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред",
      "рд╕рдорд╛рдзрд╛рди": "рдирдЬрджреАрдХреА рдкреБрд▓рд┐рд╕ рд╕реНрдЯреЗрд╢рди рдореЗрдВ рд╢рд┐рдХрд╛рдпрдд рджрд░реНрдЬ рдХрд░рд╛рдПрдВ рдпрд╛ 100 рдкрд░ рдХреЙрд▓ рдХрд░реЗрдВ",
      "Category": "рджрд╣реЗрдЬ"
    }
  ],
  emotionalSupport: [
    {
      "message": "рдЖрдк рдЕрдХреЗрд▓реА рдирд╣реАрдВ рд╣реИрдВ, рд╣рдо рдЖрдкрдХреЗ рд╕рд╛рде рд╣реИрдВ тЭдя╕П\nрдЖрдкрдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╣рдорд╛рд░реА рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рд╣реИ",
      "keywords": ["рдбрд░ рд▓рдЧрддрд╛ рд╣реИ", "рдЕрдХреЗрд▓реА рдорд╣рд╕реВрд╕ рдХрд░рддреА рд╣реВрдБ", "рдХреЛрдИ рд╕рд╣рд╛рд░рд╛ рдирд╣реАрдВ"]
    },
    {
      "message": "рдЖрдк рдмрд╣реБрдд рд╕рд╛рд╣рд╕реА рд╣реИрдВ, рдЕрдкрдиреА рднрд╛рд╡рдирд╛рдУрдВ рдХреЛ рд╡реНрдпрдХреНрдд рдХрд░рдирд╛ рд╕рд╣реА рд╣реИ ЁЯТк\nрдХреГрдкрдпрд╛ рдорджрдж рдорд╛рдВрдЧрдиреЗ рдореЗрдВ рд╕рдВрдХреЛрдЪ рди рдХрд░реЗрдВ",
      "keywords": ["рд╣рд┐рдореНрдордд рдЯреВрдЯ рд░рд╣реА рд╣реИ", "рдердХ рдЧрдИ рд╣реВрдБ", "рдЕрдм рдФрд░ рдирд╣реАрдВ рд╕рд╣ рд╕рдХрддреА"]
    },
    {
      "message": "рдЖрдк рдЬреИрд╕реА рдорд╣рд┐рд▓рд╛рдПрдВ рд╣рдорд╛рд░реЗ рд╕рдорд╛рдЬ рдХреА рдиреАрдВрд╡ рд╣реИрдВ ЁЯМ╕\nрдХреГрдкрдпрд╛ рдЕрдкрдиреЗ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЦрдбрд╝реЗ рд╣реЛрдВ, рд╣рдо рдЖрдкрдХреЗ рд╕рд╛рде рд╣реИрдВ",
      "keywords": ["рдореЗрд░реА рдХреЛрдИ рд╕реБрдирдиреЗ рд╡рд╛рд▓рд╛ рдирд╣реАрдВ", "рдореИрдВ рдХреНрдпрд╛ рдХрд░реВрдБ", "рд▓реЛрдЧ рдХреНрдпрд╛ рдХрд╣реЗрдВрдЧреЗ"]
    }
  ]
};

function MahilaSahyogChatbot() {
  const [messages, setMessages] = useState([
    {
      text: "рдирдорд╕реНрддреЗ рджреАрджреА! рдореИрдВ рдЖрдкрдХреА рдХреИрд╕реЗ рдорджрдж рдХрд░ рд╕рдХрддреА рд╣реВрдБ?\n\nрдЖрдк рдирд┐рдореНрди рд╡рд┐рд╖рдпреЛрдВ рдкрд░ рдорджрдж рдорд╛рдВрдЧ рд╕рдХрддреА рд╣реИрдВ:\nтАв рдШрд░реЗрд▓реВ рд╣рд┐рдВрд╕рд╛\nтАв рдХрд╛рд░реНрдпрд╕реНрдерд▓ рдЙрддреНрдкреАрдбрд╝рди\nтАв рдмрд╛рд▓ рд╡рд┐рд╡рд╛рд╣\nтАв рджрд╣реЗрдЬ рд╕рдВрдмрдВрдзреА рдореБрджреНрджреЗ\nтАв рдЕрдиреНрдп рдХреЛрдИ рд╕рдорд╕реНрдпрд╛\n\nрдЖрдк рдЕрдкрдиреА рд╕рдорд╕реНрдпрд╛ рд▓рд┐рдЦ рд╕рдХрддреА рд╣реИрдВ рдпрд╛ рдорд╛рдЗрдХ рдмрдЯрди рджрдмрд╛рдХрд░ рдмреЛрд▓ рд╕рдХрддреА рд╣реИрдВред",
      sender: 'bot'
    }
  ]);
  const [input, setInput] = useState('');
  const [isListening, setIsListening] = useState(false);
  const recognitionRef = useRef(null);
  const messagesEndRef = useRef(null);

  useEffect(() => {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
      recognitionRef.current = new SpeechRecognition();
      recognitionRef.current.lang = 'hi-IN';
      recognitionRef.current.interimResults = false;

      recognitionRef.current.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        setInput(transcript);
        handleSend(transcript);
      };

      recognitionRef.current.onerror = () => setIsListening(false);
      recognitionRef.current.onend = () => setIsListening(false);
    }

    return () => recognitionRef.current?.stop();
  }, []);

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const startListening = () => {
    if (recognitionRef.current && !isListening) {
      recognitionRef.current.start();
      setIsListening(true);
    }
  };

  const stopListening = () => {
    if (recognitionRef.current && isListening) {
      recognitionRef.current.stop();
      setIsListening(false);
    }
  };

  const handleSend = (userInput = input) => {
    const query = userInput.trim();
    if (!query) return;

    setMessages(prev => [...prev, { text: query, sender: 'user' }]);
    setInput('');

    const emotionalSupport = lawData.emotionalSupport.find(support =>
      support.keywords.some(keyword => query.includes(keyword))
    );

    if (emotionalSupport) {
      setMessages(prev => [...prev, {
        text: `${emotionalSupport.message}\n\nрдпрджрд┐ рдЖрдкрдХреЛ рдХрд╛рдиреВрдиреА рд╕рд╣рд╛рдпрддрд╛ рдЪрд╛рд╣рд┐рдП, рддреЛ рдХреГрдкрдпрд╛ рдЕрдкрдиреА рд╕рдорд╕реНрдпрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдмрддрд╛рдПрдВред`,
        sender: 'bot'
      }]);
      return;
    }

    let foundHelp = false;
    const lowerQuery = query.toLowerCase();

    for (const category in lawData.categories) {
      const catData = lawData.categories[category];
      if (catData.keywords.some(keyword => lowerQuery.includes(keyword.toLowerCase()))) {
        const relevantActs = lawData.acts.filter(act => act.Category === category);
        relevantActs.forEach(act => {
          const response = `тЪЦя╕П ${act.рдХрд╛рдиреВрди} (${act.рд╕рд╛рд▓})\n\n${act.рд╡рд┐рд╡рд░рдг}\n\nЁЯЫбя╕П рд╕рдорд╛рдзрд╛рди: ${act.рд╕рдорд╛рдзрд╛рди}\n\nтШОя╕П рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: ${catData.helpline}`;
          setMessages(prev => [...prev, { text: response, sender: 'bot' }]);
        });
        foundHelp = true;
      }
    }

    if (!foundHelp) {
      setMessages(prev => [...prev, {
        text: `рдорд╛рдл рдХреАрдЬрд┐рдП, рдореИрдВ рдЖрдкрдХреА рд╕рдорд╕реНрдпрд╛ рдкреВрд░реА рддрд░рд╣ рдирд╣реАрдВ рд╕рдордЭ рдкрд╛рдИред\n\nрдХреГрдкрдпрд╛ рдЗрди рдирдВрдмрд░реЛрдВ рдкрд░ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ:\nЁЯФ╕ рдорд╣рд┐рд▓рд╛ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: 181\nЁЯФ╕ рдкреБрд▓рд┐рд╕: 100\nЁЯФ╕ рд░рд╛рд╖реНрдЯреНрд░реАрдп рдорд╣рд┐рд▓рд╛ рдЖрдпреЛрдЧ: 7827-170-170\n\nрдЖрдкрдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╣рдорд╛рд░реА рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рд╣реИ тЭдя╕П`,
        sender: 'bot'
      }]);
    }
  };

  return (
    <div className="app">
      <h1><Heart size={24} color="#d81b60" /> рдорд╣рд┐рд▓рд╛ рд╕рд╢рдХреНрддрд┐рдХрд░рдг рд╕рд╣рд╛рдпрддрд╛</h1>

      <div className="chat-container">
        {messages.map((msg, index) => (
          <div key={index} className={`message ${msg.sender}`}>
            <div className="message-icon">
              {msg.sender === 'user' ? <User size={20} /> : <Bot size={20} color="#d81b60" />}
            </div>
            <div className="message-text">{msg.text}</div>
          </div>
        ))}
        <div ref={messagesEndRef} />
      </div>

      <div className="input-area">
        <input
          type="text"
          value={input}
          onChange={(e) => setInput(e.target.value)}
          placeholder="рдЕрдкрдиреА рд╕рдорд╕реНрдпрд╛ рд▓рд┐рдЦреЗрдВ рдпрд╛ рдмреЛрд▓реЗрдВ..."
          onKeyPress={(e) => e.key === 'Enter' && handleSend()}
        />

        <div className="button-group">
          <button
            onClick={isListening ? stopListening : startListening}
            className={`icon-btn ${isListening ? 'active' : ''}`}
            title="рд╡реЙрдЗрд╕ рдЗрдирдкреБрдЯ"
          >
            {isListening ? <MicOff size={20} /> : <Mic size={20} />}
          </button>

          <button
            onClick={() => handleSend()}
            disabled={!input.trim()}
            className="send-btn"
            title="рд╕рдВрджреЗрд╢ рднреЗрдЬреЗрдВ"
          >
            <SendHorizonal size={20} />
          </button>
        </div>
      </div>

      <div className="emergency-info">
        <AlertCircle size={18} color="#d81b60" />
        <p>рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд╕рд╣рд╛рдпрддрд╛: рдорд╣рд┐рд▓рд╛ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди - 181 | рдкреБрд▓рд┐рд╕ - 100 | рдмрд╛рд▓ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди - 1098</p>
      </div>
    </div>
  );
}

export default MahilaSahyogChatbot;
